---
title: "NYPD"
output: pdf_document
date: "`r Sys.Date()`"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# This report provides a comprehensive analysis of shooting incidents in New York City
# between 2006 and 2021. The study examines temporal  and spatial variations, highlighting
# borough-level disparities and temporal patterns, including day-of-year and time-of-day trends. 
# The findings aim to support law enforcement strategies and inform community safety initiatives.

## 1-Load Library and read in Data

```{r}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
library(ggplot2)

```
## 2-Read NYPD Data 
```{r}

url_NYPD <- "https://data.cityofnewyork.us/api/views/833y-fsy8/rows.csv?accessType=DOWNLOAD"

NYPD <- read.csv(url_NYPD)

```
# Introduction and Research Question: The objective of this study is to investigate spatial and temporal.
## factors influencing gun violence in New York City. This research seeks to answer the following questions:
## What borough-level and time-based patterns are most strongly associated with shootings,and how can this information inform public policy and law enforcement interventions?

## 3- Data Retrieval and Cleaning


```{r}

NYPD_clean <- NYPD %>%
  select(c("OCCUR_DATE","OCCUR_TIME","BORO","PRECINCT",
           "STATISTICAL_MURDER_FLAG","VIC_AGE_GROUP","VIC_SEX","VIC_RACE")) %>%
  mutate(OCCUR_DATE = mdy(OCCUR_DATE),
         OCCUR_TIME = hms(OCCUR_TIME),
         STATISTICAL_MURDER_FLAG = as.logical(STATISTICAL_MURDER_FLAG),
         Shootings = 1,
         Year = year(OCCUR_DATE))

NYPD_clean %>%
  ggplot(aes(x = BORO, fill = BORO)) +
  geom_bar() +
  labs(title = "NYPD Shootings Incidents by Borough",
       subtitle = "(2006 - 2021)",
       x = "NYC Boroughs",
       y = "Total Number of Shootings",
       caption = "(Figure - 1)")

NYPD_clean %>%
  ggplot(aes(x = Year)) +
  geom_bar(fill = "lightblue",show.legend = FALSE) +
  labs(title = "NYPD Shootings Incidents by Year",
       x = "Years (2006 - 2021)",
       y = "Total Number of Shootings",
       caption = "(Figure - 2)")
```
NYPD shooting incidents covering calendar years 2006 through 2021



 (Figure - 1) Shootings by Borough

Visualization: Bar chart showing total shootings by borough.
Insights:
-Brooklyn has the highest number of shootings.
-Staten Island has the lowest number.

(Figure - 2) Shootings by Year 

Visualization: Bar chart displaying total shootings per year.
Insights:
-Shootings peaked around 2011.
-A gradual decline in recent years.

Shootings Trends Over Years 
```{r}
NYPD_year <- NYPD_clean %>%
  group_by(Year,Shootings) %>%
  summarize(Shootings = sum(Shootings),
            STATISTICAL_MURDER_FLAG = sum(STATISTICAL_MURDER_FLAG)) %>%
  select(Year,Shootings,STATISTICAL_MURDER_FLAG) %>%
  ungroup()

NYPD_year %>% slice_max(Shootings, n = 4)
NYPD_year %>% slice_min(Shootings, n = 4)
NYPD_year %>%
  ggplot(aes(x = Year, y = Shootings)) +
  geom_line() +
  geom_point(color="red") +
  scale_x_discrete(limits = c(2006:2021)) +
  labs(
    title = "NYPD Shooting Incidents by Year",
    x = "Years (2006 - 2021)",
    y = "Total Number of Shootings",
    caption = "(Figure - 3)")
```
(Figure - 3) Shootings Trends Over Years 

Visualization: Line chart representing shootings trend over 2006-2021.
Insights:
-Overall decreasing trend in shootings.
-Anomaly in 2021 (possible data incompleteness).
Borough-wise Shootings Over Time
```{r}
NYPD_boro <- NYPD_clean %>%
  group_by(BORO, OCCUR_DATE,Shootings) %>%
  summarize(Shootings = sum(Shootings),
            STATISTICAL_MURDER_FLAG = sum(STATISTICAL_MURDER_FLAG)) %>%
  select(BORO,OCCUR_DATE,Shootings,STATISTICAL_MURDER_FLAG) %>%
  ungroup()

NYPD_boro_year <- NYPD_clean %>%
  mutate(Year = year(OCCUR_DATE)) %>%
  group_by(BORO, Year, Shootings) %>%
  summarize(Shootings = sum(Shootings),
            STATISTICAL_MURDER_FLAG = sum(STATISTICAL_MURDER_FLAG)) %>%
  select(BORO, Year,Shootings,STATISTICAL_MURDER_FLAG) %>%
  ungroup()

NYPD_boro_total <- NYPD_boro_year %>%
  group_by(BORO) %>%
  summarize(Shootings = sum(Shootings))
(7402 + 10365)/ sum(NYPD_boro_total$Shootings)
736/ sum(NYPD_boro_total$Shootings)
NYPD_boro_year %>%
  ggplot(aes(x = Year, y = Shootings,color = BORO)) +
  geom_line() +
  geom_point() +
  labs(title = "NYPD Shootings by Borough by Year",
       subtitle = "(2006 - 2021)",
       x = "Year",
       y = "Number of Shootings",
       caption = "(Figure - 4)")

```
(Figure - 4)

Visualization: Line chart depicting borough-wise shootings by year.
Insights:
-Brooklyn consistently has the highest shootings.
-Other boroughs show varying trends.
NYPD Shootings Per Day
```{r}
NYPD_date <- NYPD_clean %>%
  group_by(OCCUR_DATE,Shootings,STATISTICAL_MURDER_FLAG) %>%
  summarize(Shootings = sum(Shootings),

            STATISTICAL_MURDER_FLAG = sum(STATISTICAL_MURDER_FLAG)) %>%
  select(OCCUR_DATE,Shootings,STATISTICAL_MURDER_FLAG) %>%
  ungroup()

NYPD_date %>% slice_max(Shootings, n=2)

NYPD_date %>%
  ggplot(aes(x = OCCUR_DATE, y = Shootings)) +
  geom_line() +
  scale_x_date(date_labels = "%Y %b") +
  labs(title = "NYPD Shootings Per Day",
       subtile = "(2006 - 2021)",
       x = "Date",
       y = "Shootings per day",
       caption = "(Figure - 5)")
```
(Figure - 5)

Visualization: Line chart illustrating the daily count of shootings from 2006 to 2021.
Insights:
-Peaks and valleys in shooting incidents over the years.
-Highest shooting days around July 4th, 2023.

Shootings on July 5, 2023
```{r}
NYPD_time_year <- NYPD_clean %>%
  mutate(Time_year = format(as.Date(OCCUR_DATE), "%m/%d")) %>%
  mutate(Time_year = as.Date(Time_year,"%m/%d")) %>%
  group_by(Time_year,Shootings) %>%
  summarize(Shootings = sum(Shootings),
            STATISTICAL_MURDER_FLAG = sum(STATISTICAL_MURDER_FLAG)) %>%
  select(Time_year,Shootings,STATISTICAL_MURDER_FLAG) %>%
  ungroup()

NYPD_time_year %>% slice_max(Shootings, n = 2)
NYPD_July_5 <- NYPD_clean %>%
  mutate(Time_year = format(as.Date(OCCUR_DATE), "%m/%d"),
         Hour = hour(OCCUR_TIME)) %>%
  mutate(Time_year = as.Date(Time_year,"%m/%d")) %>%
  filter(Time_year == "2022-07-05") %>%
  group_by(Hour,Shootings) %>%
  summarize(Shootings = sum(Shootings))


NYPD_time_year %>%
  ggplot(aes(x = Time_year, y = Shootings)) +
  geom_line() +
  geom_point(data = NYPD_time_year %>% slice_max(Shootings, n = 2),
             aes(color="Most Shootings")) +
  scale_x_date(date_labels = "%b") +
  labs(title = "NYPD Shootings on that Day",
       subtile = "(2006 - 2021)",
       colour = "",
       x = "Day",
       y = "Shootings on that day",
       caption = "(Figure - 6)")
```
(Figure - 6)

Visualization: Line chart showing shootings on July 5, 2023, with a focus on the top two shooting days.
Insights:
-July 5, 2023, had the highest number of shootings.
-The second-highest shootings occurred on July 4, 2023.


 NYPD Shootings by the Time of Day
```{r}
NYPD_time_day <- NYPD_clean %>%
  group_by(OCCUR_TIME,Shootings) %>%
  summarize(Shootings = sum(Shootings),
            STATISTICAL_MURDER_FLAG = sum(STATISTICAL_MURDER_FLAG)) %>%
  select(OCCUR_TIME,Shootings,STATISTICAL_MURDER_FLAG)

NYPD_time_day %>%
  ggplot(aes(x = OCCUR_TIME, y = Shootings)) +
  geom_line() +
  scale_x_time() +
  labs(title = "NYPD Shootings by the Time of Day",
       subtitle = "(2006 - 2021)",
       x = "Time of day (24 Hour Time System)",
       y = "Shootings",
       caption = "(Figure - 7)")

NYPD_time_hour <- NYPD_clean %>%
  mutate(Hour = hour(OCCUR_TIME)) %>%
  group_by(Hour,Shootings) %>%
  summarize(Shootings = sum(Shootings),
            STATISTICAL_MURDER_FLAG = sum(STATISTICAL_MURDER_FLAG)) %>%
  mutate(Hour2 = Hour^2) %>%
  select(Hour,Shootings,STATISTICAL_MURDER_FLAG, Hour2)

NYPD_time_hour_model <- lm(data = NYPD_time_hour, Shootings ~ Hour + Hour2)
summary(NYPD_time_hour_model)
NYPD_time_hour %>%
  ggplot(aes(x = Hour, y = Shootings)) +
  geom_point() +
  stat_smooth(method = "lm", formula = y ~ x + I(x^2), size = 1) +
  labs(title = "NYPD Shootings by Time of Day per Hour",
       subtitle = "(2006-2021)",
       x = " Hours (24 Hour Time System)",
       y = "Shootings that Hour",
       caption = "(Figure - 8)")
```


(Figure - 7)

Visualization: Line chart presenting the distribution of shootings throughout the 24-hour time system.
Insights:
-Shootings tend to be higher during the early morning hours.

(Figure - 8)
Time of Day Analysis with Polynomial Regression 

Model: Polynomial regression model applied to analyze shootings per hour.

Model Insights:
-The model suggests a quadratic relationship between the hour of the day and shootings.
-Residuals indicate a good fit to the data.
-Shooting incidents are concentrated during specific hours.


# Conclusion:

# Findings: - Brooklyn recorded the highest number of shootings, while Staten Island reported the lowest.
## - Shooting incidents peaked in 2011, followed by a gradual decline, though a data anomaly was noted
## in 2021. - Time-of-day analysis revealed concentrated activity during specific hours, modeled using
## polynomial regression. - Notable spikes were observed around national holidays, particularly July 4th and 5th.

# Bias and Limitations: 
## - Reporting Bias: Shooting incidents rely on police reports, which may not capture all incidents.
## - Temporal Bias: Incomplete data for recent years can skew trend analysis. - Geographic
# Bias: Borough-level summaries may obscure neighborhood-level disparities.
## - Demographic Bias: Misreporting or missing demographic data introduces uncertainty.
## - Model Limitations: The regression model focused on time of day, excluding broader socioeconomic variables.

# Recommendations: The analysis underscores significant temporal and spatial trends in:
## Gun violence across New York City. Future research should integrate additional socioeconomic and environmental data to better contextualize these patterns.
## Addressing data quality and reporting accuracy remains critical for effective policy design and public safety strategies.

